#!/usr/bin/make -f

ifeq ($(shell dpkg-architecture -qDEB_HOST_MULTIARCH),x86_64-linux-gnu)
    EXE=dsr-rpsy-linux-64bit.lnx
endif
ifeq ($(shell dpkg-architecture -qDEB_HOST_MULTIARCH),i386-linux-gnu)
    EXE=dsr-rpsy-linux-32bit.lnx
endif
ifeq ($(shell dpkg-architecture -qDEB_HOST_MULTIARCH),arm-linux-gnueabihf)
    EXE=dsr-rpsy-raspberrypi.lnx
endif

# dh_dwz on buster don't like when there is no .debug_info section
ifneq ($(shell sed -n "s/^VERSION_CODENAME=//p" /etc/os-release),buster)
    RUN_DHDWZ=dh_dwz 
endif

%:
	dh $@

override_dh_auto_configure:
	dh_auto_configure
	(cd debian; \
	  for i in *.in; do\
	  o=`basename $$i .in`;\
	  sed -e 's/@EXE@/${EXE}/g' -e 's/@DEB_HOST_MULTIARCH@/$(DEB_HOST_MULTIARCH)/g' "$$i" > "$$o"; \
	  done )
	(cd debian/scripts; \
	  for i in *.in; do\
	  o=`basename $$i .in`;\
	  sed -e 's/@EXE@/${EXE}/g' -e 's/@DEB_HOST_MULTIARCH@/$(DEB_HOST_MULTIARCH)/g' "$$i" > "$$o"; \
	  done )

override_dh_dwz:
	$(RUN_DHDWZ)

override_dh_shlibdeps:
	dh_shlibdeps -- -xlibsdl1.2debian

