From: Arne Wichmann <aw@linux.de>
Date: Sat, 29 Oct 2011 14:57:15 +0200
Subject: CVE-2009-3995f

Patch for CVE-2009-3995 and CVE-2009-3996
---
 loaders/load_it.c  |    4 ++++
 loaders/load_ult.c |    3 +++
 2 files changed, 7 insertions(+)

diff --git a/loaders/load_it.c b/loaders/load_it.c
index de40bb6..c6094fb 100644
--- a/loaders/load_it.c
+++ b/loaders/load_it.c
@@ -862,6 +862,10 @@ BOOL IT_Load(BOOL curious)
 #endif
 
 				IT_ProcessEnvelope(vol);
+				/* fix for CVE-2009-3995 - snatched from SuSe's fix -- AW */
+				if (ih.volpts>= ENVPOINTS)
+					ih.volpts = ENVPOINTS-1;
+
 				for(u=0;u<ih.volpts;u++)
 					d->volenv[u].val=(ih.volnode[u]<<2);
 
diff --git a/loaders/load_ult.c b/loaders/load_ult.c
index 8e302a8..cd87154 100644
--- a/loaders/load_ult.c
+++ b/loaders/load_ult.c
@@ -224,6 +224,9 @@ BOOL ULT_Load(BOOL curious)
 	for(u=0;u<of.numchn;u++)
 		for(t=0;t<of.numpat;t++)
 			of.patterns[(t*of.numchn)+u]=tracks++;
+	/* fix for CVE-2009-3996 - snatched from SuSe's fix -- AW */
+    if (of.numchn>=UF_MAXCHAN)
+		of.numchn=UF_MAXCHAN - 1;
 
 	/* read pan position table for v1.5 and higher */
 	if(mh.id[14]>='3') {
