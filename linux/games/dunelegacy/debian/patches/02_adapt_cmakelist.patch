Description: adapt CMakeLists
 adapt to better suit the Linux FHS
 and also remove cmake package creation for Linux
Author: Nicolas HOUDELOT <nicolas@demosdebs.org>
Applied-Upstream: no
Last-Update: 2025-12-06
---
This patch header follows DEP-3: http://dep.debian.net/deps/dep3/
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -369,7 +369,15 @@
 endif()
 
 # Find miniupnpc for UPnP support
-find_package(miniupnpc CONFIG REQUIRED)
+#find_package(miniupnpc CONFIG REQUIRED)
+find_package(PkgConfig)
+if(PKG_CONFIG_FOUND)
+  pkg_check_modules(MINIUPNPC miniupnpc)
+  if(MINIUPNPC_FOUND)
+    target_include_directories(dunelegacy PRIVATE ${MINIUPNPC_INCLUDE_DIRS})
+    target_link_libraries(dunelegacy PRIVATE ${MINIUPNPC_LIBRARIES})
+  endif()
+endif()
 
 # Find discord-rpc for Discord Rich Presence
 find_library(DISCORD_RPC_LIBRARY discord-rpc PATHS ${CMAKE_PREFIX_PATH}/lib)
@@ -383,7 +391,6 @@
         $<IF:$<TARGET_EXISTS:SDL2_mixer::SDL2_mixer>,SDL2_mixer::SDL2_mixer,SDL2_mixer::SDL2_mixer-static>
         $<IF:$<TARGET_EXISTS:SDL2_ttf::SDL2_ttf>,SDL2_ttf::SDL2_ttf,SDL2_ttf::SDL2_ttf-static>
         CURL::libcurl
-        miniupnpc::miniupnpc
         ${DISCORD_RPC_LIBRARY}
 )
 
@@ -503,7 +510,7 @@
     # Linux: use FHS structure
     install(
         DIRECTORY ${DATA_DIR}/
-        DESTINATION ${CMAKE_INSTALL_DATADIR}/${PROJECT_NAME}
+        DESTINATION ${CMAKE_INSTALL_DATADIR}/games/dunelegacy
         FILES_MATCHING PATTERN "*.*"
     )
 endif()
@@ -545,8 +552,8 @@
         # Linux: use FHS structure with share/DuneLegacy
         target_compile_definitions(dunelegacy
             PRIVATE
-                DATA_DIRECTORY="${CMAKE_INSTALL_DATADIR}/${PROJECT_NAME}"
-                DUNELEGACY_DATADIR="${CMAKE_INSTALL_FULL_DATADIR}/${PROJECT_NAME}"
+                DATA_DIRECTORY="${CMAKE_INSTALL_DATADIR}/games/dunelegacy"
+                DUNELEGACY_DATADIR="${CMAKE_INSTALL_FULL_DATADIR}/games/dunelegacy"
         )
     endif()
 endif() 
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -151,8 +151,8 @@
 else()
     # Unix/Linux FHS structure
     set(DUNELEGACY_INSTALL_ROOT "${CMAKE_INSTALL_BINDIR}")
-    set(DUNELEGACY_DATA_DIR "${CMAKE_INSTALL_DATADIR}/${PROJECT_NAME}")
-    set(DUNELEGACY_CONFIG_DIR "${CMAKE_INSTALL_DATADIR}/${PROJECT_NAME}/config")
+    set(DUNELEGACY_DATA_DIR "${CMAKE_INSTALL_DATADIR}/games/dunelegacy")
+    set(DUNELEGACY_CONFIG_DIR "${CMAKE_INSTALL_DATADIR}/games/dunelegacy/config")
     set(DUNELEGACY_DOC_DIR "${CMAKE_INSTALL_DOCDIR}")
 endif()
 
@@ -331,31 +331,7 @@
         COMMENT "Building macOS DMG installer (manual hdiutil - bypasses CPack caching issues)..."
     )
 else()
-    set(CPACK_GENERATOR "DEB;RPM;TGZ")
-    set(CPACK_DEBIAN_PACKAGE_SECTION "games")
-    set(CPACK_DEBIAN_PACKAGE_DEPENDS "libsdl2-2.0-0, libsdl2-mixer-2.0-0, libsdl2-ttf-2.0-0")
-    set(CPACK_DEBIAN_PACKAGE_MAINTAINER "Dune Legacy Team")
-    set(CPACK_RPM_PACKAGE_LICENSE "GPL-2.0+")
-    set(CPACK_RPM_PACKAGE_GROUP "Amusements/Games")
-    set(CPACK_PACKAGE_FILE_NAME "DuneLegacy-${PROJECT_VERSION}-Linux-x64")
-    
-    # Add custom target for Linux packages
-    add_custom_target(package
-        COMMAND ${CMAKE_COMMAND} -E echo "Cleaning CPack cache and install directory..."
-        COMMAND ${CMAKE_COMMAND} -E remove_directory ${CMAKE_BINARY_DIR}/_CPack_Packages
-        COMMAND ${CMAKE_COMMAND} -E remove ${CMAKE_BINARY_DIR}/*.deb ${CMAKE_BINARY_DIR}/*.rpm ${CMAKE_BINARY_DIR}/*.tar.gz
-        COMMAND ${CMAKE_COMMAND} -E remove_directory ${CMAKE_BINARY_DIR}/install
-        COMMAND ${CMAKE_COMMAND} -E echo "Building binary..."
-        COMMAND ${CMAKE_COMMAND} --build . --config Release
-        COMMAND ${CMAKE_COMMAND} -E echo "Removing install directory to force fresh install..."
-        COMMAND ${CMAKE_COMMAND} -E remove_directory ${CMAKE_BINARY_DIR}/install
-        COMMAND ${CMAKE_COMMAND} -E echo "Installing to staging directory..."
-        COMMAND ${CMAKE_COMMAND} --install . --prefix install --config Release
-        COMMAND ${CMAKE_COMMAND} -E echo "Creating packages..."
-        COMMAND ${CMAKE_CPACK_COMMAND} -G "DEB;RPM;TGZ" -C Release
-        WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
-        COMMENT "Building Linux packages (DEB, RPM, TGZ) (with guaranteed fresh install)..."
-    )
+
 endif()
 
 include(CPack) 
