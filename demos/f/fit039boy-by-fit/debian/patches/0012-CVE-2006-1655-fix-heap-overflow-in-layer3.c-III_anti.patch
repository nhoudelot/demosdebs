From: Simon McVittie <smcv@debian.org>
Date: Sun, 16 Mar 2014 21:00:31 +0000
Subject: CVE-2006-1655: fix heap overflow in layer3.c::III_antialias()

This combines two patches taken from mpg123: the original fix by Daniel
Kobras, and "extended fix for CVE-2006-1655" from upstream 0.61.

Origin: vendor, Debian (mpg123/0.59r-22); upstream (mpg123/0.61)
Author: Daniel Kobras <kobras@debian.org>
Author: thor
Ref: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=361863
---
 mpglib/layer3.c | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

--- a/mpglib/layer3.c
+++ b/mpglib/layer3.c
@@ -1459,7 +1459,10 @@
  * and mode = mixed_mode 
  */
            int sfb = gr_info->maxbandl;
-           int idx = bi->longIdx[sfb];
+           int idx;
+           if (sfb > 21)
+             return;
+           idx = bi->longIdx[sfb];
 
            for ( ; sfb<8; sfb++ )
            {
@@ -1483,7 +1486,10 @@
       else /* ((gr_info->block_type != 2)) */
       {
         int sfb = gr_info->maxbandl;
-        int is_p,idx = bi->longIdx[sfb];
+        int is_p,idx;
+        if (sfb > 21)
+          return;
+        idx = bi->longIdx[sfb];
         for ( ; sfb<21; sfb++)
         {
           int sb = bi->longDiff[sfb];
