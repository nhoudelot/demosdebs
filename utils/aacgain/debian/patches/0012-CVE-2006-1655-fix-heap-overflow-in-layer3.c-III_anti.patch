From: Simon McVittie <smcv@debian.org>
Date: Sun, 16 Mar 2014 21:00:31 +0000
Subject: CVE-2006-1655: fix heap overflow in layer3.c::III_antialias()

This combines two patches taken from mpg123: the original fix by Daniel
Kobras, and "extended fix for CVE-2006-1655" from upstream 0.61.

Origin: vendor, Debian (mpg123/0.59r-22); upstream (mpg123/0.61)
Author: Daniel Kobras <kobras@debian.org>
Author: thor
Ref: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=361863
---
 mp3gain/mpglibDBL/layer3.c | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

diff --git a/mp3gain/mpglibDBL/layer3.c b/mp3gain/mpglibDBL/layer3.c
index 4016a2a..793857c 100644
--- a/mp3gain/mpglibDBL/layer3.c
+++ b/mp3gain/mpglibDBL/layer3.c
@@ -1113,7 +1113,10 @@ maybe still wrong??? (copy 12 to 13?) */
  * and mode = mixed_mode 
  */
            int sfb = gr_infos->maxbandl;
-           int idx = bi->longIdx[sfb];
+           int idx;
+           if (sfb > 21)
+             return;
+           idx = bi->longIdx[sfb];
 
            for ( ; sfb<8; sfb++ )
            {
@@ -1137,7 +1140,10 @@ maybe still wrong??? (copy 12 to 13?) */
       else /* ((gr_infos->block_type != 2)) */
       {
         int sfb = gr_infos->maxbandl;
-        int is_p,idx = bi->longIdx[sfb];
+        int is_p,idx;
+        if (sfb > 21)
+          return;
+        idx = bi->longIdx[sfb];
         for ( ; sfb<21; sfb++)
         {
           int sb = bi->longDiff[sfb];
